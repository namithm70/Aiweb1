(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{22:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return t(9255)}])},9255:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var a=t(5893),r=t(7294),l=t(1163),n=t(8885),i=t(6781),c=t(6805),o=t(2450);let d=()=>{let[e,s]=(0,r.useState)({messages:[],loading:!1,selectedDocs:[],error:void 0}),t=(0,r.useCallback)(e=>{let t={...e,id:Date.now().toString(),timestamp:new Date().toISOString()};return s(e=>({...e,messages:[...e.messages,t]})),t.id},[]),a=(0,r.useCallback)((e,t)=>{s(s=>({...s,messages:s.messages.map(s=>s.id===e?{...s,...t}:s)}))},[]),l=(0,r.useCallback)(e=>{s(s=>({...s,messages:s.messages.filter(s=>s.id!==e)}))},[]),n=(0,r.useCallback)(e=>{s(s=>({...s,selectedDocs:e}))},[]),i=(0,r.useCallback)(async r=>{if(!r.trim())return;s(e=>({...e,loading:!0,error:void 0})),t({role:"user",content:r});let l=t({role:"assistant",content:"",loading:!0});try{let t={question:r,doc_ids:e.selectedDocs.length>0?e.selectedDocs:void 0,k:6},n=await o.xU.askQuestion(t),i=o.xU.parseStreamingResponse(n),c="",d=[],m=!0;for await(let e of i)if("token"===e.type&&e.content)m&&(a(l,{loading:!1}),m=!1),c+=e.content,a(l,{content:c});else if("citation"===e.type&&e.citation)d.push(e.citation);else if("complete"===e.type&&e.final_response)a(l,{content:e.final_response.answer,citations:e.final_response.citations,loading:!1});else if("error"===e.type)throw Error(e.error||"Unknown error occurred");s(e=>({...e,loading:!1}))}catch(t){let e=(0,o.zG)(t);a(l,{content:"Sorry, I encountered an error: ".concat(e.detail),loading:!1}),s(s=>({...s,loading:!1,error:e.detail}))}},[e.selectedDocs,t,a]),c=(0,r.useCallback)(s=>{let t=e.messages.find(e=>e.id===s);if(t&&"user"===t.role){let a=e.messages.findIndex((t,a)=>a>e.messages.findIndex(e=>e.id===s)&&"assistant"===t.role);-1!==a&&l(e.messages[a].id),i(t.content)}},[e.messages,i,l]),d=(0,r.useCallback)(()=>{s(e=>({...e,messages:[],error:void 0}))},[]),m=(0,r.useCallback)(()=>{s(e=>({...e,error:void 0}))},[]),x=(0,r.useCallback)(()=>e.messages.filter(e=>"user"===e.role),[e.messages]),u=(0,r.useCallback)(()=>e.messages.filter(e=>"assistant"===e.role),[e.messages]),h=(0,r.useCallback)(()=>e.messages[e.messages.length-1],[e.messages]),g=(0,r.useCallback)(()=>{let e=[],s=x(),t=u();return s.forEach((s,a)=>{let r=t[a];e.push({user:s,assistant:r})}),e},[x,u]);return{...e,askQuestion:i,retryQuestion:c,addMessage:t,updateMessage:a,removeMessage:l,clearMessages:d,clearError:m,setSelectedDocs:n,getUserMessages:x,getAssistantMessages:u,getLastMessage:h,getMessagePairs:g,hasMessages:e.messages.length>0,isWaitingForResponse:e.loading||e.messages.some(e=>e.loading)}};var m=t(4931),x=t(2201),u=t(3431),h=t(5567),g=t(5356),p=t(4910),y=t(3950),f=t(2637);let j=e=>{let{message:s,onRetry:t,onCopy:r}=e,l="user"===s.role,i=s.loading;return(0,a.jsxs)("div",{className:"flex space-x-3 ".concat(l?"justify-end":"justify-start"),children:[!l&&(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(x.Z,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{className:"max-w-3xl ".concat(l?"message-user":i?"message-loading":"message-assistant"),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsx)("div",{className:"flex-1",children:i?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"typing-dots",children:[(0,a.jsx)("div",{className:"typing-dot"}),(0,a.jsx)("div",{className:"typing-dot"}),(0,a.jsx)("div",{className:"typing-dot"})]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Thinking..."})]}):(0,a.jsx)(n.UG,{className:"prose prose-sm max-w-none",components:{p:e=>{let{children:s}=e;return(0,a.jsx)("p",{className:"mb-2 last:mb-0",children:s})},ul:e=>{let{children:s}=e;return(0,a.jsx)("ul",{className:"list-disc list-inside mb-2",children:s})},ol:e=>{let{children:s}=e;return(0,a.jsx)("ol",{className:"list-decimal list-inside mb-2",children:s})}},children:s.content})}),!i&&!l&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 ml-2",children:[(0,a.jsx)("button",{onClick:()=>r(s.content),className:"p-1 text-gray-400 hover:text-gray-600 focus:outline-none",title:"Copy message",children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:t,className:"p-1 text-gray-400 hover:text-gray-600 focus:outline-none",title:"Retry question",children:(0,a.jsx)(p.Z,{className:"h-4 w-4"})})]})]}),s.citations&&s.citations.length>0&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Sources:"}),(0,a.jsx)("div",{className:"space-y-2",children:s.citations.map((e,s)=>(0,a.jsx)(N,{citation:e,index:s+1},s))})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:new Date(s.timestamp).toLocaleTimeString()})]}),l&&(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(y.Z,{className:"h-5 w-5 text-white"})})]})},N=e=>{let{citation:s,index:t}=e;return(0,a.jsxs)("div",{className:"flex items-start space-x-2 p-2 bg-gray-50 rounded text-xs",children:[(0,a.jsxs)("span",{className:"citation",children:["S",t]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-700",children:s.doc_name}),(0,a.jsxs)("p",{className:"text-gray-600 mb-1",children:["Page ",s.page]}),(0,a.jsxs)("p",{className:"text-gray-500 italic",children:['"',s.excerpt,'"']})]})]})};var b=()=>{let{user:e,loading:s}=(0,i.a)(),{documents:t}=(0,c.s)(),{messages:n,loading:o,selectedDocs:g,error:p,askQuestion:y,retryQuestion:N,clearMessages:b,clearError:v,setSelectedDocs:w,isWaitingForResponse:k}=d(),C=(0,l.useRouter)(),[_,D]=(0,r.useState)(""),[S,E]=(0,r.useState)(!1),Z=(0,r.useRef)(null),R=(0,r.useRef)(null);(0,r.useEffect)(()=>{s||e||C.push("/login")},[e,s,C]),(0,r.useEffect)(()=>{var e;null===(e=Z.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[n]),(0,r.useEffect)(()=>{var e;null===(e=R.current)||void 0===e||e.focus()},[]);let U=t.filter(e=>"ready"===e.status),q=async e=>{if(e.preventDefault(),!_.trim()||k)return;let s=_.trim();D(""),v(),await y(s)},I=e=>{g.includes(e)?w(g.filter(s=>s!==e)):w([...g,e])},P=async e=>{try{await navigator.clipboard.writeText(e)}catch(e){console.error("Failed to copy text:",e)}};return s?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"spinner mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e?0===U.length?(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(m.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No documents ready"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Upload and process some PDF documents before you can start chatting."}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{onClick:()=>C.push("/documents"),className:"btn btn-primary",children:"Upload Documents"})})]})}):(0,a.jsx)(f.Z,{children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto flex h-[calc(100vh-8rem)]",children:[(0,a.jsxs)("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Document Selection"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:0===g.length?"All documents":"".concat(g.length," selected")})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,a.jsx)("div",{className:"space-y-2",children:U.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer p-2 rounded-md hover:bg-gray-50",children:[(0,a.jsx)("input",{type:"checkbox",checked:g.includes(e.id),onChange:()=>I(e.id),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.page_count," pages â€¢ ",e.chunk_count," chunks"]})]})]},e.id))})}),g.length>0&&(0,a.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:()=>w([]),className:"w-full btn btn-secondary text-sm",children:"Clear Selection"})})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Chat with Documents"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Ask questions about your documents and get answers with citations"})]}),n.length>0&&(0,a.jsx)("button",{onClick:b,className:"btn btn-secondary text-sm",children:"Clear Chat"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===n.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(x.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Start a conversation"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Ask questions about your documents to get started."}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Example questions:"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("button",{onClick:()=>D("What are the main topics covered in these documents?"),className:"block mx-auto text-xs text-primary-600 hover:text-primary-500",children:'"What are the main topics covered in these documents?"'}),(0,a.jsx)("button",{onClick:()=>D("Can you summarize the key findings?"),className:"block mx-auto text-xs text-primary-600 hover:text-primary-500",children:'"Can you summarize the key findings?"'})]})]})]}):(0,a.jsx)("div",{className:"space-y-4",children:n.map(e=>(0,a.jsx)(j,{message:e,onRetry:()=>N(e.id),onCopy:P},e.id))}),(0,a.jsx)("div",{ref:Z})]}),p&&(0,a.jsx)("div",{className:"mx-4 mb-4 bg-red-50 border border-red-200 rounded-md p-3",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(u.Z,{className:"h-5 w-5 text-red-400 mt-0.5"}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsx)("p",{className:"text-sm text-red-800",children:p}),(0,a.jsx)("button",{onClick:v,className:"mt-1 text-sm text-red-600 hover:text-red-500 underline",children:"Dismiss"})]})]})}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:(0,a.jsxs)("form",{onSubmit:q,className:"flex space-x-2",children:[(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)("textarea",{ref:R,value:_,onChange:e=>D(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),q(e))},placeholder:"Ask a question about your documents...",disabled:k,rows:1,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:opacity-50 disabled:cursor-not-allowed resize-none",style:{minHeight:"40px",maxHeight:"120px"}})}),(0,a.jsx)("button",{type:"submit",disabled:!_.trim()||k,className:"btn btn-primary px-3 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:k?(0,a.jsx)("div",{className:"spinner"}):(0,a.jsx)(h.Z,{className:"h-5 w-5"})})]})})]})]})}):null}}},function(e){e.O(0,[424,772,175,888,774,179],function(){return e(e.s=22)}),_N_E=e.O()}]);